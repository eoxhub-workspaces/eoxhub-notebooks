<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>eoAPI registration example - EOxHub Notebooks</title><meta property="og:title" content="eoAPI registration example - EOxHub Notebooks"/><meta name="generator" content="mystmd"/><meta name="description" content="Collection of examples for EOxHub Workspaces"/><meta property="og:description" content="Collection of examples for EOxHub Workspaces"/><meta name="keywords" content=""/><link rel="stylesheet" href="/eoxhub-notebooks/build/_assets/app-2K3KGISG.css"/><link rel="stylesheet" href="/eoxhub-notebooks/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/eoxhub-notebooks/favicon.ico"/><link rel="stylesheet" href="/eoxhub-notebooks/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="myst-skip-to-article fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="myst-skip-to-link block px-2 py-1 text-black underline">Skip to article content</a></div><dialog id="myst-no-css" style="position:fixed;left:0px;top:0px;width:100%;height:100vh;font-size:4rem;padding:1rem;color:black;background:white"><strong>Site not loading correctly?</strong><p>This may be due to an incorrect <code>BASE_URL</code> configuration. See<!-- --> <a href="https://mystmd.org/guide/deployment#deploy-base-url">the MyST Documentation</a> <!-- -->for reference.</p><script>
    (() => {
            // Test for has-styling variable set by the MyST stylesheet
            const node = document.currentScript.parentNode;
            const hasCSS = window.getComputedStyle(node).getPropertyValue("--has-styling");
            if (hasCSS === ""){
                    node.showModal();
            }

    })()
</script></dialog><div class="myst-top-nav bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-full top-0 z-30 h-[60px]"><nav class="myst-top-nav-bar flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><div class="block lg:hidden"><button class="myst-top-nav-menu-button flex items-center justify-center border-stone-400 text-stone-800 hover:text-stone-900 dark:text-stone-200 hover:dark:text-stone-100 w-10 h-10"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" width="1.5rem" height="1.5rem"><path fill-rule="evenodd" d="M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path></svg><span class="sr-only">Open Menu</span></button></div><a class="myst-home-link flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/eoxhub-notebooks/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R75cp:" data-state="closed" class="myst-search-bar flex items-center h-10 aspect-square sm:w-64 text-left text-gray-600 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 myst-search-bar-disabled hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="myst-search-text-placeholder hidden sm:block grow">Search</span><div aria-hidden="true" class="myst-search-shortcut items-center hidden mx-1 font-mono text-sm text-gray-600 dark:text-gray-300 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="myst-theme-button theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-10 h-10 mx-3" title="Toggle theme between light and dark mode" aria-label="Toggle theme between light and dark mode"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-moon-icon h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="myst-theme-sun-icon h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><div class="myst-primary-sidebar fixed xl:article-grid grid-gap xl:w-full xl:pointer-events-none overflow-auto max-xl:w-[75vw] max-xl:max-w-[350px] max-xl:!top-0 max-xl:h-screen lg:hidden hidden z-10" style="top:60px"><div class="myst-primary-sidebar-pointer pointer-events-auto xl:col-margin-left flex-col overflow-hidden max-xl:h-full hidden xl:flex"><div class="myst-primary-sidebar-nav flex-grow py-6 overflow-y-auto primary-scrollbar"><nav aria-label="Navigation" class="myst-primary-sidebar-topnav overflow-y-hidden transition-opacity lg:hidden ml-3 xl:ml-0 mr-3 max-w-[350px]"><div class="w-full px-1 dark:text-white font-medium"></div></nav></div></div></div><main class="article-grid grid-gap"><article class="article-grid subgrid-gap col-screen article content"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="myst-fm-block mb-8 pt-9"><div class="myst-fm-block-header flex items-center mb-5 h-6 text-sm font-light"><div class="myst-fm-block-subject flex-none pr-2 smallcaps">Notebook examples</div><div class="flex-grow"></div><div class="myst-fm-block-badges"><a href="https://github.com/eoxhub-workspaces/eoxhub-notebooks" title="GitHub Repository: eoxhub-workspaces/eoxhub-notebooks" target="_blank" rel="noopener noreferrer" class="myst-fm-github-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="myst-fm-github-icon inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a></div><a href="https://github.com/eoxhub-workspaces/eoxhub-notebooks/edit/main/notebooks/eoAPI/eoAPI_registration.ipynb" title="Edit This Page" target="_blank" rel="noopener noreferrer" class="myst-fm-edit-link text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-edit-icon inline-block mr-1 opacity-60 hover:opacity-100"><path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"></path></svg></a><div class="myst-fm-downloads-dropdown relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="myst-fm-downloads-button relative ml-2 -mr-1" id="headlessui-menu-button-:Rs8ucp:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem" class="myst-fm-downloads-icon"><title>Download</title><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="myst-fm-block-title mb-0">eoAPI registration example</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="TpT62xf059" class="myst-jp-nb-block relative group/block"><p>This notebook demonstrates how to register data on the workspace eoAPI instance. The main step is creation of STAC metadata information to pass it to the eoAPI STAC endpoint.
In order to show the full flow this notebooks also fetches some sample data and does following steps:</p><ol start="1"><li><p><strong>Download</strong>: Download file to mounted bucket path.</p></li><li><p><strong>Collection creation</strong>: Create the STAC collection the file will be registered to.</p></li><li><p><strong>Metadata extraction</strong>: Extract as much information as possible from source file to create STAC item.</p></li><li><p><strong>Ingest</strong>: Post the resulting STAC ttem to the eoAPI STAC endpoint.</p></li></ol></div><div id="gutqHQzUu5" class="myst-jp-nb-block relative group/block"><h3 id="environment-checks" class="relative group"><span class="heading-text">Environment Checks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#environment-checks" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="VLlcNcX9Yi" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># First some checks to see the environment is as expected
import sys
import os
import importlib.util

# List the packages to check
required = [&quot;pystac&quot;, &quot;rio_stac&quot;, &quot;pystac_client&quot;, &quot;requests&quot;, &quot;rasterio&quot;]
missing = [p for p in required if importlib.util.find_spec(p.replace(&#x27;-&#x27;,&#x27;_&#x27;)) is None]

if missing:
    print(f&quot; ERROR: Missing packages: {&#x27;, &#x27;.join(missing)}&quot;)
    print(&quot;It looks like the wrong Conda kernel is active. Please switch kernels and try again.&quot;)
    sys.exit(&quot;Execution stopped: Missing dependencies.&quot;)

# If check passes, proceed with imports
from datetime import datetime, timezone
from pystac import Collection, Extent, SpatialExtent, TemporalExtent, Link
from rio_stac import create_stac_item
import rasterio
import requests

print(&quot; Environment ready.&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="fckvVj2vqMf-_rQMtuG4n" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>✅ Environment ready.
</span></code></pre></div></div></div></div><div id="LoJAHaFJWs" class="myst-jp-nb-block relative group/block"><h2 id="configuration" class="relative group"><span class="heading-text">Configuration</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#configuration" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>If using your own file adjust <code>FILE_PATH</code> to match its location and remove the download step.</p></div><div id="HzLPgBNHSv" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">STAC_API_URL = &quot;http://eoapi-rw-stac:8080&quot; 
COLLECTION_ID = &quot;demo-collection&quot;
COG_SOURCE_URL = &quot;https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/36/Q/WD/2020/7/S2A_36QWD_20200701_0_L2A/TCI.tif&quot;
FILE_PATH = &quot;./bucket/demo_data/TCI.tif&quot;

os.makedirs(os.path.dirname(FILE_PATH), exist_ok=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="I7WunVaB4lEQ0XlHX8PbS" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="uOuNxp8gwr" class="myst-jp-nb-block relative group/block"><h2 id="id-1-download" class="relative group"><span class="heading-text">1. Download</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-1-download" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="gQn4WhpxQi" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># First we download the example file and put it into the mounted bucket
# You can also use the File Browser to upload your data
# (should be used for files smaller then 1 GB)
if os.path.exists(FILE_PATH):
    print(f&quot;File exists at {FILE_PATH}. Skipping.&quot;)
else:
    print(f&quot;Downloading to {FILE_PATH}...&quot;)
    with requests.get(COG_SOURCE_URL, stream=True) as r:
        r.raise_for_status()
        with open(FILE_PATH, &#x27;wb&#x27;) as f:
            for chunk in r.iter_content(chunk_size=8192):
                f.write(chunk)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="MhzvDEQ5dRvzUONWFypVQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>File exists at ./bucket/demo_data/TCI.tif. Skipping.
</span></code></pre></div></div></div></div><div id="BpuMXb01Fq" class="myst-jp-nb-block relative group/block"><h2 id="id-2-collection-creation" class="relative group"><span class="heading-text">2. Collection creation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-2-collection-creation" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="XYS8JP3Vtd" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Then we create the collection (only if it does not already exist)
check_url = f&quot;{STAC_API_URL}/collections/{COLLECTION_ID}&quot;
resp = requests.get(check_url)
if resp.status_code == 200:
    print(f&quot;Collection &#x27;{COLLECTION_ID}&#x27; exists.&quot;)
else:
    print(f&quot;Creating collection &#x27;{COLLECTION_ID}&#x27;...&quot;)
    coll = Collection(
        id=COLLECTION_ID,
        title=&quot;Demo collection&quot;,
        description=&quot;Demo COG collection&quot;,
        extent=Extent(SpatialExtent([[-180, -90, 180, 90]]), TemporalExtent([[datetime(2020,1,1,tzinfo=timezone.utc), None]])),
        license=&quot;CC-BY-4.0&quot;
    )
    # Sending a POST request with the Collection json to create the collection
    requests.post(f&quot;{STAC_API_URL}/collections&quot;, json=coll.to_dict()).raise_for_status()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="GEO1FGUO33oLLwq5M44Hx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Creating collection &#x27;demo-collection&#x27;...
</span></code></pre></div></div></div></div><div id="tNDfifl5eF" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># If we wanted to delete the collection we could use following command
# requests.delete(f&quot;{STAC_API_URL}/collections/{COLLECTION_ID}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="8Q1vB-o5KkUHmK_De5Z8d" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="EUl23QPWk4" class="myst-jp-nb-block relative group/block"><h2 id="id-3-metadata-extraction" class="relative group"><span class="heading-text">3. Metadata Extraction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-3-metadata-extraction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="IXCA8cwjEb" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># We need a STAC item definition in order to register it into the collection
# see https://github.com/radiantearth/stac-spec/blob/master/item-spec/item-spec.md for further details

# rio-stac provides a useful helper tool create_stac_item
# to extract metadata from the raster file and create a STAC item from it

# We need to define the connected bucket to this workspace
BUCKET = os.getenv(&quot;workspace_BUCKET&quot;)
ROOT_FILE_PATH = FILE_PATH.replace(&quot;./bucket&quot;, &quot;&quot;)
# cloud location eoAPI TiTiler will access the data assets from
S3_URI = f&quot;s3://{BUCKET}{ROOT_FILE_PATH}&quot;

item = create_stac_item(
    source=FILE_PATH,
    asset_href=S3_URI,
    id=os.path.basename(ROOT_FILE_PATH).split(&#x27;.&#x27;)[0],
    collection=COLLECTION_ID,
    asset_name=&quot;data&quot;
)

# Add preview link to allow rendering data in eoAPI GUI
eoapi_endpoint = os.getenv(&quot;workspace_RASTER_ENDPOINT&quot;)
xyz = f&quot;{eoapi_endpoint}/collections/{COLLECTION_ID}/items/{item.id}/tiles/WebMercatorQuad/{{z}}/{{x}}/{{y}}?assets=data&quot;
item.add_link(Link(rel=&quot;xyz&quot;, target=xyz, media_type=&quot;application/json&quot;))
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="_5FJXcsm-tmHH6dc6CtZb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZUZJoCNtnE" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># We can print the item by uncommenting if we want to have a look
# item.to_dict()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="ylatnNLltpS1c1KB3X2Jq" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="RrgbpW1NLO" class="myst-jp-nb-block relative group/block"><h2 id="id-4-ingestion" class="relative group"><span class="heading-text">4. Ingestion</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#id-4-ingestion" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="ru1q18gxPs" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Now that the item was created we can pass it to eoAPI for ingestion

url = f&quot;{STAC_API_URL}/collections/{COLLECTION_ID}/items&quot;
response = requests.post(url, json=item.to_dict())

if response.status_code in [200, 201]:
    print(&quot;Successfully posted STAC Item.&quot;)
else:
    print(f&quot;Error {response.status_code}: {response.text}&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="xLUXJYfRAWbOAc_U48uYo" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>Successfully posted STAC Item.
</span></code></pre></div></div></div></div><div id="jKnC86ls5f" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Update temporal and spatial extent based on ingested datasets
import requests

def update_stac(url, cid):
    # 1. Fetch all items (limited to 1000 for brevity)
    items = requests.get(f&quot;{url}/collections/{cid}/items?limit=1000&quot;).json()[&#x27;features&#x27;]
    
    # 2. Extract and calculate (flatten coordinates and collect dates)
    coords = [pt for f in items for pt in f[&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0]]
    dts = [f[&#x27;properties&#x27;][&#x27;datetime&#x27;] for f in items]
    
    # 3. Patch the collection
    ext = {
        &quot;spatial&quot;: {&quot;bbox&quot;: [[min(c[0] for c in coords), min(c[1] for c in coords), 
                             max(c[0] for c in coords), max(c[1] for c in coords)]]},
        &quot;temporal&quot;: {&quot;interval&quot;: [[min(dts), max(dts)]]}
    }
    
    r = requests.patch(f&quot;{url}/collections/{cid}&quot;, json={&quot;extent&quot;: ext})
    print(&quot;✅ Updated&quot; if r.ok else f&quot;❌ Error: {r.text}&quot;)

update_stac(STAC_API_URL, COLLECTION_ID)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="YdeVfAAqFHJvR8bREBG8D" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div data-name="safe-output-stream"><div><pre class="myst-jp-stream-output text-sm font-thin font-system"><code><span>✅ Updated
</span></code></pre></div></div></div></div><div id="S2W2FDp1Tl" class="myst-jp-nb-block relative group/block"><div class="myst-jp-nb-block-spinner flex sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:hidden"><div class="flex absolute top-0 right-0"></div></div><div class="myst-jp-nb-block sticky top-[115px] z-10 opacity-90 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute -top-[12px] right-0 flex flex-row rounded bg-white dark:bg-slate-800"></div></div><div class="relative myst-code group not-prose my-5 text-sm shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 border border-l-4 border-gray-200 border-l-blue-400 dark:border-l-blue-400 dark:border-gray-800"><pre class="block overflow-auto p-3 myst-code-body hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from IPython.display import Image, display

url = f&quot;{eoapi_endpoint}/collections/demo-collection/items/TCI/preview?assets=data&quot;
display(Image(url=url, width=500))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 myst-code-copy-icon top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-name="outputs-container" data-mdast-node-id="utUafC_suwsVxL73tnDBK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div class="myst-backmatter-parts"></div></article></main><script>((a,l)=>{if(!window.history.state||!window.history.state.key){let u=Math.random().toString(32).slice(2);window.history.replaceState({key:u},"")}try{let d=JSON.parse(sessionStorage.getItem(a)||"{}")[l||window.history.state.key];typeof d=="number"&&window.scrollTo(0,d)}catch(u){console.error(u),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/eoxhub-notebooks/build/entry.client-PCJPW7TK.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-AQ2CODAG.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-JJXTQVMA.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-OZE3FFNP.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-G62B6HZR.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-C4DFGG5C.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-J7TUH54J.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-FZ2S7OYD.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-JEM6JXYA.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-34XIY2DH.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-KQM5FBHR.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-7HNKBP4B.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-CUKUDK3R.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-3EBOCCHJ.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-O4VQNZ62.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-4OEDG4JQ.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/root-PMP5BIHC.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/_shared/chunk-IX5KPAHP.js"/><link rel="modulepreload" href="/eoxhub-notebooks/build/routes/$-5ZLZ2O3Y.js"/><script>window.__remixContext = {"url":"/notebooks/eoapi/eoapi-registration","state":{"loaderData":{"root":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true,"style":"/eoxhub-notebooks/build/custom-16119b67e8ada6e1f72689bf350b1541.css"},"nav":[],"actions":[],"projects":[{"subject":"Notebook examples","title":"EOxHub Notebooks","description":"Collection of examples for EOxHub Workspaces","github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","id":"feb2375d-3838-4365-bbd7-f43d501cdcbe","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"title":"Data Access","level":2},{"slug":"notebooks.data-access.cdse-basic-data-access","title":"CDSE Basic Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"notebooks.data-access.cdse-tiled-data-access","title":"CDSE Tiled Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"EoAPI","level":2},{"slug":"notebooks.eoapi.eoapi-registration","title":"eoAPI registration example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Pangeo Dask Notebooks","level":2},{"slug":"notebooks.pangeo-dask-notebooks.example-wildfires","title":"Scale your processes with Dask - hands on example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/eoxhub-notebooks"},"routes/$":{"config":{"version":3,"myst":"1.8.0","options":{"hide_toc":true,"hide_footer_links":true,"folders":true,"style":"/eoxhub-notebooks/build/custom-16119b67e8ada6e1f72689bf350b1541.css"},"nav":[],"actions":[],"projects":[{"subject":"Notebook examples","title":"EOxHub Notebooks","description":"Collection of examples for EOxHub Workspaces","github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","id":"feb2375d-3838-4365-bbd7-f43d501cdcbe","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"title":"Data Access","level":2},{"slug":"notebooks.data-access.cdse-basic-data-access","title":"CDSE Basic Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"notebooks.data-access.cdse-tiled-data-access","title":"CDSE Tiled Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"EoAPI","level":2},{"slug":"notebooks.eoapi.eoapi-registration","title":"eoAPI registration example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Pangeo Dask Notebooks","level":2},{"slug":"notebooks.pangeo-dask-notebooks.example-wildfires","title":"Scale your processes with Dask - hands on example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}]},"page":{"version":3,"kind":"Notebook","sha256":"d3f2baeccc048d989b8464304e87b84aaece2cfca524367429ee3fd89baf30a7","slug":"notebooks.eoapi.eoapi-registration","location":"/notebooks/eoAPI/eoAPI_registration.ipynb","dependencies":[],"frontmatter":{"title":"eoAPI registration example","content_includes_title":false,"kernelspec":{"name":"conda-env-global-global-eoxhub_general-py","display_name":"global-global-eoxhub_general","language":"python"},"github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","subject":"Notebook examples","numbering":{"title":{"offset":2}},"source_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/blob/main/notebooks/eoAPI/eoAPI_registration.ipynb","edit_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/edit/main/notebooks/eoAPI/eoAPI_registration.ipynb","exports":[{"format":"ipynb","filename":"eoAPI_registration.ipynb","url":"/eoxhub-notebooks/build/eoAPI_registration-4297355266094e5691167c97023d1045.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"metadata":{"description":"This notebook demonstrates how to register data on the workspace eoAPI instance. The main step is creation of STAC metadata information to pass it to the eoAPI STAC endpoint.","title":"eoAPI registration example"}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how to register data on the workspace eoAPI instance. The main step is creation of STAC metadata information to pass it to the eoAPI STAC endpoint.\nIn order to show the full flow this notebooks also fetches some sample data and does following steps:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hfiphaPIth"}],"key":"DuC90OManA"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Download","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Gnam3XxzIu"}],"key":"sy7tWxm7KD"},{"type":"text","value":": Download file to mounted bucket path.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KUzpgrtfXh"}],"key":"ar27p3j98c"}],"key":"yfJD2Ni08E"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Collection creation","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"JL9Twdz0pu"}],"key":"Q11cOj4qkj"},{"type":"text","value":": Create the STAC collection the file will be registered to.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hDiKptSitf"}],"key":"J4742QUEX3"}],"key":"Iodst1ANEi"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Metadata extraction","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"NV7AEB5egs"}],"key":"CWm5B8QDdA"},{"type":"text","value":": Extract as much information as possible from source file to create STAC item.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"CMjsEgjeci"}],"key":"I6jsVQkK7F"}],"key":"IJuORiavzu"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Ingest","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"YLOrMkUggp"}],"key":"IHPX3bGNkZ"},{"type":"text","value":": Post the resulting STAC ttem to the eoAPI STAC endpoint.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Cl3cZZsbUD"}],"key":"meXcxug7PX"}],"key":"OTPMPzTirP"}],"key":"o8I5uNdGL5"}],"key":"TpT62xf059"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Environment Checks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GqpyZuGZuw"}],"identifier":"environment-checks","label":"Environment Checks","html_id":"environment-checks","implicit":true,"key":"unHtdgQHQE"}],"key":"gutqHQzUu5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# First some checks to see the environment is as expected\nimport sys\nimport os\nimport importlib.util\n\n# List the packages to check\nrequired = [\"pystac\", \"rio_stac\", \"pystac_client\", \"requests\", \"rasterio\"]\nmissing = [p for p in required if importlib.util.find_spec(p.replace('-','_')) is None]\n\nif missing:\n    print(f\" ERROR: Missing packages: {', '.join(missing)}\")\n    print(\"It looks like the wrong Conda kernel is active. Please switch kernels and try again.\")\n    sys.exit(\"Execution stopped: Missing dependencies.\")\n\n# If check passes, proceed with imports\nfrom datetime import datetime, timezone\nfrom pystac import Collection, Extent, SpatialExtent, TemporalExtent, Link\nfrom rio_stac import create_stac_item\nimport rasterio\nimport requests\n\nprint(\" Environment ready.\")","key":"zsxvCrtQoS"},{"type":"outputs","id":"fckvVj2vqMf-_rQMtuG4n","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"✅ Environment ready.\n"},"children":[],"key":"empPUEefZI"}],"key":"baMmJ8VozG"}],"key":"VLlcNcX9Yi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Configuration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LcEnbZjloC"}],"identifier":"configuration","label":"Configuration","html_id":"configuration","implicit":true,"key":"ie3g96yqfq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"If using your own file adjust ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"irN0F28aOO"},{"type":"inlineCode","value":"FILE_PATH","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yIOeKhC6W2"},{"type":"text","value":" to match its location and remove the download step.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"l5DmKMEPwn"}],"key":"dZvqN8QU8P"}],"key":"LoJAHaFJWs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"STAC_API_URL = \"http://eoapi-rw-stac:8080\" \nCOLLECTION_ID = \"demo-collection\"\nCOG_SOURCE_URL = \"https://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/36/Q/WD/2020/7/S2A_36QWD_20200701_0_L2A/TCI.tif\"\nFILE_PATH = \"./bucket/demo_data/TCI.tif\"\n\nos.makedirs(os.path.dirname(FILE_PATH), exist_ok=True)","key":"qom9A3ugd6"},{"type":"outputs","id":"I7WunVaB4lEQ0XlHX8PbS","children":[],"key":"Fnnb20OcDQ"}],"key":"HzLPgBNHSv"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1. Download","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pfyWVcSTiM"}],"identifier":"id-1-download","label":"1. Download","html_id":"id-1-download","implicit":true,"key":"OGuUegPH9f"}],"key":"uOuNxp8gwr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# First we download the example file and put it into the mounted bucket\n# You can also use the File Browser to upload your data\n# (should be used for files smaller then 1 GB)\nif os.path.exists(FILE_PATH):\n    print(f\"File exists at {FILE_PATH}. Skipping.\")\nelse:\n    print(f\"Downloading to {FILE_PATH}...\")\n    with requests.get(COG_SOURCE_URL, stream=True) as r:\n        r.raise_for_status()\n        with open(FILE_PATH, 'wb') as f:\n            for chunk in r.iter_content(chunk_size=8192):\n                f.write(chunk)","key":"ONr6DCZCt8"},{"type":"outputs","id":"MhzvDEQ5dRvzUONWFypVQ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"File exists at ./bucket/demo_data/TCI.tif. Skipping.\n"},"children":[],"key":"hXZ690Wo8X"}],"key":"bsFU00xBDZ"}],"key":"gQn4WhpxQi"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. Collection creation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"A48AWsh111"}],"identifier":"id-2-collection-creation","label":"2. Collection creation","html_id":"id-2-collection-creation","implicit":true,"key":"qlgCgiAEfj"}],"key":"BpuMXb01Fq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Then we create the collection (only if it does not already exist)\ncheck_url = f\"{STAC_API_URL}/collections/{COLLECTION_ID}\"\nresp = requests.get(check_url)\nif resp.status_code == 200:\n    print(f\"Collection '{COLLECTION_ID}' exists.\")\nelse:\n    print(f\"Creating collection '{COLLECTION_ID}'...\")\n    coll = Collection(\n        id=COLLECTION_ID,\n        title=\"Demo collection\",\n        description=\"Demo COG collection\",\n        extent=Extent(SpatialExtent([[-180, -90, 180, 90]]), TemporalExtent([[datetime(2020,1,1,tzinfo=timezone.utc), None]])),\n        license=\"CC-BY-4.0\"\n    )\n    # Sending a POST request with the Collection json to create the collection\n    requests.post(f\"{STAC_API_URL}/collections\", json=coll.to_dict()).raise_for_status()","key":"MB0RNMrwBO"},{"type":"outputs","id":"GEO1FGUO33oLLwq5M44Hx","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Creating collection 'demo-collection'...\n"},"children":[],"key":"pPHADB2tdF"}],"key":"uVTK4EgzML"}],"key":"XYS8JP3Vtd"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# If we wanted to delete the collection we could use following command\n# requests.delete(f\"{STAC_API_URL}/collections/{COLLECTION_ID}\")","key":"tfZ9K3Vofj"},{"type":"outputs","id":"8Q1vB-o5KkUHmK_De5Z8d","children":[],"key":"SMAOuzP7ZF"}],"key":"tNDfifl5eF"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"3. Metadata Extraction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K1SMJDrbY6"}],"identifier":"id-3-metadata-extraction","label":"3. Metadata Extraction","html_id":"id-3-metadata-extraction","implicit":true,"key":"kc1WpxdKpo"}],"key":"EUl23QPWk4"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# We need a STAC item definition in order to register it into the collection\n# see https://github.com/radiantearth/stac-spec/blob/master/item-spec/item-spec.md for further details\n\n# rio-stac provides a useful helper tool create_stac_item\n# to extract metadata from the raster file and create a STAC item from it\n\n# We need to define the connected bucket to this workspace\nBUCKET = os.getenv(\"workspace_BUCKET\")\nROOT_FILE_PATH = FILE_PATH.replace(\"./bucket\", \"\")\n# cloud location eoAPI TiTiler will access the data assets from\nS3_URI = f\"s3://{BUCKET}{ROOT_FILE_PATH}\"\n\nitem = create_stac_item(\n    source=FILE_PATH,\n    asset_href=S3_URI,\n    id=os.path.basename(ROOT_FILE_PATH).split('.')[0],\n    collection=COLLECTION_ID,\n    asset_name=\"data\"\n)\n\n# Add preview link to allow rendering data in eoAPI GUI\neoapi_endpoint = os.getenv(\"workspace_RASTER_ENDPOINT\")\nxyz = f\"{eoapi_endpoint}/collections/{COLLECTION_ID}/items/{item.id}/tiles/WebMercatorQuad/{{z}}/{{x}}/{{y}}?assets=data\"\nitem.add_link(Link(rel=\"xyz\", target=xyz, media_type=\"application/json\"))\n","key":"hnvHa5A9lB"},{"type":"outputs","id":"_5FJXcsm-tmHH6dc6CtZb","children":[],"key":"c1ek7qXgtp"}],"key":"IXCA8cwjEb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# We can print the item by uncommenting if we want to have a look\n# item.to_dict()","key":"RHyahuYTSf"},{"type":"outputs","id":"ylatnNLltpS1c1KB3X2Jq","children":[],"key":"NsuqaXc0Um"}],"key":"ZUZJoCNtnE"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"4. Ingestion","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QlsBxvXlwk"}],"identifier":"id-4-ingestion","label":"4. Ingestion","html_id":"id-4-ingestion","implicit":true,"key":"KSRVHnQy4k"}],"key":"RrgbpW1NLO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Now that the item was created we can pass it to eoAPI for ingestion\n\nurl = f\"{STAC_API_URL}/collections/{COLLECTION_ID}/items\"\nresponse = requests.post(url, json=item.to_dict())\n\nif response.status_code in [200, 201]:\n    print(\"Successfully posted STAC Item.\")\nelse:\n    print(f\"Error {response.status_code}: {response.text}\")","key":"jm1l1rYA3s"},{"type":"outputs","id":"xLUXJYfRAWbOAc_U48uYo","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Successfully posted STAC Item.\n"},"children":[],"key":"FUzrphCAYY"}],"key":"QN4OyVmwGn"}],"key":"ru1q18gxPs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Update temporal and spatial extent based on ingested datasets\nimport requests\n\ndef update_stac(url, cid):\n    # 1. Fetch all items (limited to 1000 for brevity)\n    items = requests.get(f\"{url}/collections/{cid}/items?limit=1000\").json()['features']\n    \n    # 2. Extract and calculate (flatten coordinates and collect dates)\n    coords = [pt for f in items for pt in f['geometry']['coordinates'][0]]\n    dts = [f['properties']['datetime'] for f in items]\n    \n    # 3. Patch the collection\n    ext = {\n        \"spatial\": {\"bbox\": [[min(c[0] for c in coords), min(c[1] for c in coords), \n                             max(c[0] for c in coords), max(c[1] for c in coords)]]},\n        \"temporal\": {\"interval\": [[min(dts), max(dts)]]}\n    }\n    \n    r = requests.patch(f\"{url}/collections/{cid}\", json={\"extent\": ext})\n    print(\"✅ Updated\" if r.ok else f\"❌ Error: {r.text}\")\n\nupdate_stac(STAC_API_URL, COLLECTION_ID)","key":"c9F5oyQGN1"},{"type":"outputs","id":"YdeVfAAqFHJvR8bREBG8D","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"✅ Updated\n"},"children":[],"key":"EF3RBfiIrH"}],"key":"eCByMikWPs"}],"key":"jKnC86ls5f"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import Image, display\n\nurl = f\"{eoapi_endpoint}/collections/demo-collection/items/TCI/preview?assets=data\"\ndisplay(Image(url=url, width=500))","key":"mCrL9k2YuE"},{"type":"outputs","id":"utUafC_suwsVxL73tnDBK","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cimg src=\"https://hub-otc-sc.eox.at/services/eoxhub-gateway/aducat/eoapi-rw-raster/collections/demo-collection/items/TCI/preview?assets=data\" width=\"500\"/\u003e","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.Image object\u003e","content_type":"text/plain"}}},"children":[],"key":"ERwqemm2B4"}],"key":"Pt4GQi7kET"}],"key":"S2W2FDp1Tl"}],"key":"Zldp656z5M"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"CDSE Tiled Data Access","url":"/notebooks/data-access/cdse-tiled-data-access","group":"Data Access"},"next":{"title":"Scale your processes with Dask - hands on example","url":"/notebooks/pangeo-dask-notebooks/example-wildfires","group":"Pangeo Dask Notebooks"}}},"domain":"http://localhost:3000"},"project":{"subject":"Notebook examples","title":"EOxHub Notebooks","description":"Collection of examples for EOxHub Workspaces","github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","id":"feb2375d-3838-4365-bbd7-f43d501cdcbe","exports":[],"bibliography":[],"index":"readme","pages":[{"title":"Notebooks","level":1},{"title":"Data Access","level":2},{"slug":"notebooks.data-access.cdse-basic-data-access","title":"CDSE Basic Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"slug":"notebooks.data-access.cdse-tiled-data-access","title":"CDSE Tiled Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"EoAPI","level":2},{"slug":"notebooks.eoapi.eoapi-registration","title":"eoAPI registration example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3},{"title":"Pangeo Dask Notebooks","level":2},{"slug":"notebooks.pangeo-dask-notebooks.example-wildfires","title":"Scale your processes with Dask - hands on example","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":3}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/eoxhub-notebooks/build/manifest-54BD5942.js";
import * as route0 from "/eoxhub-notebooks/build/root-PMP5BIHC.js";
import * as route1 from "/eoxhub-notebooks/build/routes/$-5ZLZ2O3Y.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/eoxhub-notebooks/build/entry.client-PCJPW7TK.js");</script>
<style>
  .custom-toolbar-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 1.25rem;
    height: 1.25rem;
    color: inherit;
    opacity: 0.6;
    transition: opacity 0.2s, color 0.2s;
    cursor: pointer;
    margin-left: 0.5rem;
  }
  .custom-back-btn { margin-right: 0.25rem; }
  .custom-toolbar-btn:hover { opacity: 1; color: #E18435; }
  .custom-rocket-btn { color: #E18435 !important; }
  .custom-rocket-btn:hover { color: #c46d24 !important; }
  .custom-toolbar-btn svg { width: 100%; height: 100%; fill: currentColor; }
</style>

<script>
  (function() {
    // 1. STATE MANAGEMENT
    // Start with the generic fallback, but we will overwrite this
    // as soon as Luigi gives us the real context.
    const DEFAULT_FALLBACK = "https://workspace.cubes-and-clouds.earthcode.eox.at/hub/user-redirect/git-pull";
    let activeHubUrl = DEFAULT_FALLBACK;
    
    const LOG_PREFIX = "🛠️ [MicroFrontend]:";
    function log(msg) { console.log(`${LOG_PREFIX} ${msg}`); }

    // --- 2. LUIGI LOADER & CONTEXT HANDLER ---
    function loadLuigiClient(callback) {
        if (window.LuigiClient) {
            setupContextListener();
            callback();
            return;
        }
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/@luigi-project/client/luigi-client.js';
        script.onload = () => {
            setupContextListener();
            callback();
        };
        document.head.appendChild(script);
    }

    function setupContextListener() {
        if (!window.LuigiClient) return;

        // Listen for the handshake data from the Parent Frame
        window.LuigiClient.addInitListener((context) => {
            log("✅ Context Received");
            
            // EXTRACT DYNAMIC HOME URL
            // structure: context.workspaceConfig.home -> "https://workspace.triallps25..."
            if (context.workspaceConfig && context.workspaceConfig.home) {
                const home = context.workspaceConfig.home;
                // Ensure no trailing slash, then append the hub path
                activeHubUrl = home.replace(/\/$/, '') + "/hub/user-redirect/git-pull";
                
                log("Updated Hub URL to: " + activeHubUrl);
                
                // Force update any buttons already rendered on the page
                refreshRocketLinks();
            }
        });
    }

    // --- 3. URL BUILDERS ---
    function getRepoInfo() {
        const editLink = document.querySelector('a.myst-fm-edit-link');
        if (!editLink || !editLink.href) return null;
        try {
            const url = new URL(editLink.href);
            const parts = url.pathname.split('/');
            if (parts.length < 6 || parts[3] !== 'edit') return null;
            return {
                repoUrl: `https://github.com/${parts[1]}/${parts[2]}`,
                branch: parts[4],
                filePath: parts.slice(5).join('/') 
            };
        } catch (e) { return null; }
    }

    function getLaunchUrl() {
        const info = getRepoInfo();
        if (!info) return null;
        
        const repoName = info.repoUrl.split('/').pop(); 
        const jupyterPath = `lab/tree/${repoName}/${info.filePath}`;
        
        // Use the DYNAMIC 'activeHubUrl' here
        const query = `?repo=${encodeURIComponent(info.repoUrl)}&urlpath=${encodeURIComponent(jupyterPath)}&branch=${info.branch}`;
        return `${activeHubUrl}${query}`;
    }

    // Helper to update existing buttons when context arrives
    function refreshRocketLinks() {
        const btn = document.querySelector('.custom-rocket-btn');
        if (btn) {
            const newUrl = getLaunchUrl();
            if (newUrl) {
                btn.href = newUrl;
                log("Refreshed Button HREF");
            }
        }
    }

    // --- 4. BUTTON CREATORS ---
    function createBackButton() {
        const btn = document.createElement('a');
        btn.className = 'custom-toolbar-btn custom-back-btn';
        btn.href = "#"; 
        btn.setAttribute('aria-label', 'Go Back');
        btn.title = "Go Back";
        btn.innerHTML = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>`;

        btn.addEventListener('click', (e) => {
            e.preventDefault();
            if (window.LuigiClient && window.LuigiClient.isLuigiClientInitialized()) {
                window.LuigiClient.linkManager().goBack();
            } else {
                window.history.back();
            }
        });
        return btn;
    }

    function createRocketButton() {
        // Initial create might happen before Context arrives
        // That's fine, we update it in 'refreshRocketLinks' later
        const absoluteUrl = getLaunchUrl();
        if (!absoluteUrl) return null;

        const link = document.createElement('a');
        link.className = 'custom-toolbar-btn custom-rocket-btn';
        link.href = absoluteUrl; 
        link.target = '_blank';
        link.setAttribute('aria-label', 'Execute in workspace');
        link.title = "Execute in workspace";
        link.innerHTML = `<svg style="width:24px;height:24px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Execute in workspace</title><path d="M13.13 22.19L11.5 18.36C13.07 17.78 14.54 17 15.9 16.09L13.13 22.19M5.64 12.5L1.81 10.87L7.91 8.1C7 9.46 6.22 10.93 5.64 12.5M19.22 4C19.5 4 19.75 4 19.96 4.05C20.13 5.44 19.94 8.3 16.66 11.58C14.96 13.29 12.93 14.6 10.65 15.47L8.5 13.37C9.42 11.06 10.73 9.03 12.42 7.34C15.18 4.58 17.64 4 19.22 4M19.22 2C17.24 2 14.24 2.69 11 5.93C8.81 8.12 7.5 10.53 6.65 12.64C6.37 13.39 6.56 14.21 7.11 14.77L9.24 16.89C9.62 17.27 10.13 17.5 10.66 17.5C10.89 17.5 11.13 17.44 11.36 17.35C13.5 16.53 15.88 15.19 18.07 13C23.73 7.34 21.61 2.39 21.61 2.39S20.7 2 19.22 2M14.54 9.46C13.76 8.68 13.76 7.41 14.54 6.63S16.59 5.85 17.37 6.63C18.14 7.41 18.15 8.68 17.37 9.46C16.59 10.24 15.32 10.24 14.54 9.46M8.88 16.53L7.47 15.12L8.88 16.53M6.24 22L9.88 18.36C9.54 18.27 9.21 18.12 8.91 17.91L4.83 22H6.24M2 22H3.41L8.18 17.24L6.76 15.83L2 20.59V22M2 19.17L6.09 15.09C5.88 14.79 5.73 14.47 5.64 14.12L2 17.76V19.17Z" /></svg>`;
        
        link.addEventListener('click', (e) => {
            const isLuigiReady = window.LuigiClient && window.LuigiClient.isLuigiClientInitialized();
            
            // RE-READ the href at click time to ensure we use the updated URL
            // (in case context arrived after button creation)
            const currentHref = link.href;

            if (isLuigiReady) {
                e.preventDefault();
                try {
                    const urlObj = new URL(currentHref);
                    const params = Object.fromEntries(urlObj.searchParams);
                    const relativePath = urlObj.pathname;
                    
                    window.LuigiClient.addCoreSearchParams(params);
                    window.LuigiClient.linkManager()
                        .preserveQueryParams(true)
                        .navigate(relativePath);
                } catch (err) {
                    window.open(currentHref, '_blank');
                }
            }
        });
        return link;
    }

    // --- 5. INJECTION LOOP ---
    function checkAndInject() {
        const toolbars = document.querySelectorAll('.myst-fm-block-header');
        toolbars.forEach(toolbar => {
            const subject = toolbar.querySelector('.myst-fm-block-subject');
            if (subject && subject.innerText.includes("Notebook examples")) {
                
                // Back Button
                if (!toolbar.querySelector('.custom-back-btn')) {
                    const backBtn = createBackButton();
                    const badges = toolbar.querySelector('.myst-fm-block-badges');
                    if (badges) toolbar.insertBefore(backBtn, badges);
                    else toolbar.appendChild(backBtn);
                }

                // Rocket Button
                if (!toolbar.querySelector('.custom-rocket-btn')) {
                    const rocketBtn = createRocketButton();
                    if (rocketBtn) toolbar.appendChild(rocketBtn);
                }
            }
        });
    }

    // --- 6. INIT ---
    window.addEventListener('load', () => {
        loadLuigiClient(() => {});
        setTimeout(() => {
            checkAndInject();
            const observer = new MutationObserver(() => checkAndInject());
            observer.observe(document.body, { childList: true, subtree: true });
        }, 1000); 
    });

  })();
</script>
</body></html>