{"version":3,"kind":"Notebook","sha256":"e71142dfff878fe71809b1683bb6237ff4e0b31d4d7ed57819c4400cb4a61273","slug":"notebooks.data-access.cdse-basic-data-access","location":"/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","dependencies":[],"frontmatter":{"title":"CDSE Basic Data Access","content_includes_title":false,"kernelspec":{"name":"conda-env-global-global-eoxhub_general-py","display_name":"global-global-eoxhub_general","language":"python"},"github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","subject":"Notebook examples","numbering":{"title":{"offset":2}},"source_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/blob/main/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","edit_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/edit/main/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","exports":[{"format":"ipynb","filename":"CDSE_Basic_Data_Access.ipynb","url":"/eoxhub-notebooks/build/CDSE_Basic_Data_Acce-1ae515f9026853e4830cef896fb04336.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"metadata":{"description":"This notebook demonstrates the simplest way to authenticate with the Copernicus Data Space Ecosystem (CDSE), download a Sentinel-2 image, and render it.","title":"CDSE Basic Data Access"}},"children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates the simplest way to authenticate with the Copernicus Data Space Ecosystem (CDSE), download a Sentinel-2 image, and render it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"smsUyLgPq8"}],"key":"tvcZc21J4A"}],"key":"PUa2Eg8vTs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport io\nimport requests\nimport rasterio\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session","key":"lXqe2zh5al"},{"type":"outputs","id":"S_K9iHSs3ty1uQ_QPUsrq","children":[],"key":"dQsELl3hlI"}],"key":"YDCu9K6LvO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# AUTHENTICATION\n# Replace with your actual credentials or ensure environment variables are set\n# Please make sure to not share a notebook with filled credentials!\nCLIENT_ID = os.getenv(\"cdse_CLIENT_ID\", \"your_id_here\")\nCLIENT_SECRET = os.getenv(\"cdse_CLIENT_SECRET\", \"your_secret_here\")\nTOKEN_URL = \"https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token\"\n\nclient = BackendApplicationClient(client_id=CLIENT_ID)\noauth = OAuth2Session(client=client)\ntoken = oauth.fetch_token(token_url=TOKEN_URL, client_secret=CLIENT_SECRET, include_client_id=True)\nprint(\"Authenticated successfully.\")","key":"ux1nfXHkJd"},{"type":"outputs","id":"khkJRYfKShRFX9D4UCwDC","children":[],"key":"ZFBNzJHnZQ"}],"key":"WP4Bq9VOZt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from datetime import datetime, timedelta\n\n# 1. Parse the found date and create a time window\n# We remove the trailing 'Z' to make it compatible with fromisoformat\ndt_str = found_date.replace('Z', '')\ndt = datetime.fromisoformat(dt_str)\n\n# Create a 1-hour window around the scene\ntime_from = (dt - timedelta(minutes=30)).strftime(\"%Y-%m-%dT%H:%M:%SZ\")\ntime_to = (dt + timedelta(minutes=30)).strftime(\"%Y-%m-%dT%H:%M:%SZ\")\n\nprint(f\"Requesting time window: {time_from} to {time_to}\")\n\n# 2. Updated Payload with buffer\nevalscript = \"\"\"\n//VERSION=3\nfunction setup() {\n    return {\n        input: [{ bands: [\"B04\", \"B03\", \"B02\"], units: \"DN\" }],\n        output: { bands: 3, sampleType: \"UINT16\" }\n    };\n}\nfunction evaluatePixel(sample) {\n    return [sample.B04, sample.B03, sample.B02];\n}\n\"\"\"\n\npayload = {\n    \"input\": {\n        \"bounds\": {\n            \"bbox\": [16.3, 48.15, 16.4, 48.25],\n            \"properties\": {\"crs\": \"http://www.opengis.net/def/crs/EPSG/0/4326\"}\n        },\n        \"data\": [{\n            \"type\": \"sentinel-2-l2a\",\n            \"dataFilter\": {\n                \"timeRange\": {\n                    \"from\": time_from,\n                    \"to\": time_to\n                }\n            }\n        }]\n    },\n    \"output\": {\n        \"width\": 512, \n        \"height\": 512,\n        \"responses\": [{\"identifier\": \"default\", \"format\": {\"type\": \"image/tiff\"}}]\n    },\n    \"evalscript\": evalscript\n}\n\nresponse = oauth.post(\"https://sh.dataspace.copernicus.eu/api/v1/process\", json=payload)\nresponse.raise_for_status()\nprint(\"Data retrieved successfully!\")","key":"xwz1yPmgCV"},{"type":"outputs","id":"FkR-tHLXbkszkFKxG45WY","children":[],"key":"u2INOTJ3ao"}],"key":"qlKWWFHsar"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\nwith rasterio.open(io.BytesIO(response.content)) as src:\n    img = src.read().transpose(1, 2, 0)\n\n# Check if we actually have data\nprint(f\"Max pixel value: {img.max()}\")\nprint(f\"Mean pixel value: {img.mean()}\")\n\n# Scale: 3000 is a good baseline for S2; increase to 2000 for even brighter images\nimg_display = np.clip(img / 3000, 0, 1)\n\nplt.figure(figsize=(5, 5))\nplt.imshow(img_display)\nplt.axis('off')\nplt.show()","key":"UyOaQ6XnRX"},{"type":"outputs","id":"kBC-50KfTA7u64dHbwMCJ","children":[],"key":"HYhCX6pHHp"}],"key":"tp75jIdPRL"}],"key":"dCuHY0gEnd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"EOxHub Notebooks","url":"/","group":"EOxHub Notebooks"},"next":{"title":"CDSE Tiled Data Access","url":"/notebooks/data-access/cdse-tiled-data-access","group":"Data Access"}}},"domain":"http://localhost:3000"}