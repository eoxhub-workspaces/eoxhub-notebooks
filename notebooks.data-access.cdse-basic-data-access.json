{"version":3,"kind":"Notebook","sha256":"fe16b2b945224e0948d9e27b2103cd9ef8fb164e0e5ee6301ba27674a62fa5a3","slug":"notebooks.data-access.cdse-basic-data-access","location":"/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","dependencies":[],"frontmatter":{"title":"CDSE Basic Data Access","content_includes_title":false,"kernelspec":{"name":"conda-env-global-global-eoxhub_general-py","display_name":"global-global-eoxhub_general","language":"python"},"github":"https://github.com/eoxhub-workspaces/eoxhub-notebooks","subject":"Notebook examples","numbering":{"title":{"offset":2}},"source_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/blob/main/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","edit_url":"https://github.com/eoxhub-workspaces/eoxhub-notebooks/edit/main/notebooks/data_access/CDSE_Basic_Data_Access.ipynb","exports":[{"format":"ipynb","filename":"CDSE_Basic_Data_Access.ipynb","url":"/eoxhub-notebooks/build/CDSE_Basic_Data_Acce-71f6a292ed183bd864f89eecd7d721e7.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates the simplest way to authenticate with the Copernicus Data Space Ecosystem (CDSE), download a Sentinel-2 image, and render it.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZhlJVi4hHE"}],"key":"hAvt7TkimG"}],"key":"A61UYQ8z5K"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport io\nimport requests\nimport rasterio\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom datetime import datetime, timedelta\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session","key":"e8T1QaUyul"},{"type":"outputs","id":"EPaDVxFjVP2lixtLhuybd","children":[],"key":"TbjaWyx96m"}],"key":"YGc7WbFuP5"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# AUTHENTICATION\n# Replace with your actual credentials or ensure environment variables are set\n# Please make sure to not share a notebook with filled credentials!\nCLIENT_ID = os.getenv(\"cdse_CLIENT_ID\", \"your_id_here\")\nCLIENT_SECRET = os.getenv(\"cdse_CLIENT_SECRET\", \"your_secret_here\")\nTOKEN_URL = \"https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token\"\n\nclient = BackendApplicationClient(client_id=CLIENT_ID)\noauth = OAuth2Session(client=client)\ntoken = oauth.fetch_token(token_url=TOKEN_URL, client_secret=CLIENT_SECRET, include_client_id=True)\nprint(\"Authenticated successfully.\")","key":"vse2PpC8fa"},{"type":"outputs","id":"mbz6dl3ZALfJkJ0bvZfD0","children":[],"key":"NLpzoGN2JK"}],"key":"AknmuWwKUo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# 1. Search for the latest cloud-free scene (Max 5% cloud)\nsearch_url = \"https://catalogue.dataspace.copernicus.eu/resto/api/collections/Sentinel2/search.json\"\nsearch_params = {\n    \"box\": \"16.3,48.15,16.4,48.25\",\n    \"startDate\": \"2024-04-01T00:00:00Z\",\n    \"completionDate\": \"2024-06-01T00:00:00Z\",\n    \"cloudCover\": \"[0,5]\",\n    \"processingLevel\": \"S2MSI2A\",\n    \"maxRecords\": 1\n}\n\nsearch_resp = requests.get(search_url, params=search_params)\nsearch_resp.raise_for_status()\nfeatures = search_resp.json().get('features', [])\n\nif not features:\n    raise Exception(\"No scenes found in this range. Try widening the dates.\")\n\n# Get the exact timestamp of the found scene\nfound_date = features[0]['properties']['startDate']\nprint(f\"Found valid scene from: {found_date}\")","key":"AhBAoetrlN"},{"type":"outputs","id":"JUva0xQpaaLdvlh6aPcps","children":[],"key":"FV5RCsx8Ce"}],"key":"ispGhi1BJw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"\n# Parse the found date and create a time window\n# We remove the trailing 'Z' to make it compatible with fromisoformat\ndt_str = found_date.replace('Z', '')\ndt = datetime.fromisoformat(dt_str)\n\n# Create a 1-hour window around the scene\ntime_from = (dt - timedelta(minutes=30)).strftime(\"%Y-%m-%dT%H:%M:%SZ\")\ntime_to = (dt + timedelta(minutes=30)).strftime(\"%Y-%m-%dT%H:%M:%SZ\")\n\nprint(f\"Requesting time window: {time_from} to {time_to}\")\n\n# 2. Updated Payload with buffer\nevalscript = \"\"\"\n//VERSION=3\nfunction setup() {\n    return {\n        input: [{ bands: [\"B04\", \"B03\", \"B02\"], units: \"DN\" }],\n        output: { bands: 3, sampleType: \"UINT16\" }\n    };\n}\nfunction evaluatePixel(sample) {\n    return [sample.B04, sample.B03, sample.B02];\n}\n\"\"\"\n\npayload = {\n    \"input\": {\n        \"bounds\": {\n            \"bbox\": [16.3, 48.15, 16.4, 48.25],\n            \"properties\": {\"crs\": \"http://www.opengis.net/def/crs/EPSG/0/4326\"}\n        },\n        \"data\": [{\n            \"type\": \"sentinel-2-l2a\",\n            \"dataFilter\": {\n                \"timeRange\": {\n                    \"from\": time_from,\n                    \"to\": time_to\n                }\n            }\n        }]\n    },\n    \"output\": {\n        \"width\": 512, \n        \"height\": 512,\n        \"responses\": [{\"identifier\": \"default\", \"format\": {\"type\": \"image/tiff\"}}]\n    },\n    \"evalscript\": evalscript\n}\n\nresponse = oauth.post(\"https://sh.dataspace.copernicus.eu/api/v1/process\", json=payload)\nresponse.raise_for_status()\nprint(\"Data retrieved successfully!\")","key":"fyLWx5txZs"},{"type":"outputs","id":"lSa6D1Rp-r40vC9mtwbF-","children":[],"key":"lzQ3tjdSqb"}],"key":"ZLryFHe3li"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import numpy as np\n\nwith rasterio.open(io.BytesIO(response.content)) as src:\n    img = src.read().transpose(1, 2, 0)\n\n# Check if we actually have data\nprint(f\"Max pixel value: {img.max()}\")\nprint(f\"Mean pixel value: {img.mean()}\")\n\n# Scale: 3000 is a good baseline for S2; increase to 2000 for even brighter images\nimg_display = np.clip(img / 3000, 0, 1)\n\nplt.figure(figsize=(5, 5))\nplt.imshow(img_display)\nplt.axis('off')\nplt.show()","key":"JdkwifkTVQ"},{"type":"outputs","id":"iUKFt1ZXX0kogZwEX7C0R","children":[],"key":"klHwdUSEZY"}],"key":"Hp5YBwN4dc"}],"key":"jZERHPEDEz"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"EOxHub Notebooks","url":"/","group":"EOxHub Notebooks"},"next":{"title":"CDSE Tiled Data Access","url":"/notebooks/data-access/cdse-tiled-data-access","group":"Data Access"}}},"domain":"http://localhost:3000"}